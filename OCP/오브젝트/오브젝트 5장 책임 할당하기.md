## 책임 주도 설계를 향해

데이터 중심의 설계에서 책임 중심의 설계로 전환하기 위해서는 다음의 두 가지 원칙을 따라야 한다.

- 데이터보다 행동을 먼저 결정하라
- 협력이라는 문맥 안에서 책임을 결정하라

### 데이터보다 행동을 먼저 결정하라

책임 중심의 설계에서는 “이 객체가 수행해야 하는 책임은 무엇인가”를 결정한 후에 “이 책임을 수행하는 데 필요한 데이터는 무엇인가’를 결정한다.

### 협력이라는 문맥 안에서 책임을 결정하라

객체에게 할당된 책임의 품질은 협력에 적합한 정도로 결정된다.

책임은 객체의 입장이 아니라 객체가 참여하는 협력에 적합해야 한다.

협력을 시작하는 주체는 메시지 전송자이기 때문에 협력에 적합한 책임이란 메시지 전송자에게 적합한 책임을 의미한다. 다시 말해서 메시지를 전송하는 클라이언트의 의도에 적합한 책임을 할당해야 한다는 것이다.

객체보다 메시지를 먼저 결정하기 때문에 송신자는 수신자에 대한 어떠한 가정도 할 수 없다. 전송자의 관점에서 수신자가 깔끔하게 캡슐화되는 것이다.

## 책임 할당을 위한 GRASP 패턴

**GRASP 패턴**

General Responsibility Assignment Software Pattern(일반적인 책임 할당을 위한 소프트웨어 패턴)의 약자로 객체에게 책임을 할당할 때 지침으로 삼을 수 있는 원칙의 집합을 패턴 형식으로 정리한 것이다.

### 도메인 개념에서 출발하기

설계를 시작하기 전에 도메인에 대한 개략적인 모습을 그려 보는 것이 유용하다. 도메인 안에는 무수히 많은 개념들이 존재하며 이 도메인 개념들을 책임 할당의 대상으로 사용하면 코드에 도메인의 모습을 투영하기가 좀 더 수월해진다.

올바른 도메인 모델이란 존재하지 않는다.

### 정보 전문가에게 책임을 할당하라

책임 주도 설계 방식의 첫 단계는 애플리케이션이 제공해야 하는 기능을 애플리케이션의 책임으로 생각하는 것이다.

1. 메시지를 전송할 객체는 무엇을 원하는가?
2. 메시지를 수신할 적합한 객체는 누구인가?

정보 전문가 패턴은 객체가 자신이 소유하고 있는 정보와 관련된 작업을 수행한다는 일반적인 직관을 표현한 것이다. 여기서 이야기하는 정보는 데이터와 다르다는 사실에 주의하라.

객체가 정보를 ‘알고’ 있다고 해서 그 정보를 ‘저장’하고 있을 필요는 없다.

정보 전문가 패턴은 객체란 상태와 행동을 함께 가지는 단위라는 객체지향의 가장 기본적인 원리를 책임 할당의 관점에서 표현한다.

### 높은 응집도와 낮은 결합도

DiscountCondition이 Movie와 협력하는 것이 좋을까, 아니면 Screening과 협력하는 것이 좋을까?

해답의 실마리는 결합도에 있다.

Screening의 가장 중요한 책임은 예매를 생성하는 것이다. 만약 Screening이 DiscountCondition과 협력해야 한다면 Screening은 계산과 관련된 책임 일부를 떠안아야 할 것이다.

Movie의 주된 책임은 영화 요금을 계산하는 것이기에 Movie와 DiscountCondition이 협력하는 것이 낮은 결합도, 높은 응집도를 가질 수 있다.

### 창조자에게 객체 생성 책임을 할당하라

영화 예매 협력의 최종 결과물은 Reservation 인스턴스를 생성하는 것이다. 이것은 협력에 참여하는 어떤 객체에게는 Reservation 인스턴스를 생성할 책임을 할당해야 한다는 것을 의미한다.

## 구현을 통한 검증

### DiscountCondition 개선하기

코드를 통해 변경의 이유를 파악할 수 있는 첫 번째 방법은 인스턴스 변수가 초기화되는 시점을 살펴보는 것이다.

DiscountCondition이 순번 조건을 표현하는 경우 sequence는 초기화되지만 dayOfWeek, startTime, endTime은 초기화되지 않는다.

클래스의 속성이 서로 다른 시점에 초기화된다는 것은 응집도가 낮다는 증거다. 따라서 **********함께 초기화되는 속성을 기준으로 코드를 분리해야 한다.**********

코드를 통해 변경의 이유를 파악할 수 있는 두 번째 방법은 **메서드들이 인스턴스 변수를 사용하는 방식**을 살펴보는 것이다. 모든 메서드가 객체의 모든 속성을 사용한다면 클래스의 응집도는 높다고 볼 수 있다.

### 타입 분리하기

DiscountCondition의 가장 큰 문제점은 순번 조건과 기간 조건이라는 두 개의 독립적인 타입이 하나의 클래스 안에 공존하고 있다는 점이다. 가장 먼저 떠오르는 해결 방법은 두 타입을 SequenceCondition과 PeriodCondition이라는 두 개의 클래스로 분리하는 것이다.

### 다형성을 통해 분리하기

Movie의 잊방에서 보면 SequenceCondition과 PeriodCondition은 아무 차이도 없다. 둘 모두 할인 여부를 판단하는 동일한 책임을 수행하고 있을 뿐이다.

SequenceCondition과 PeriodCondition은 동일한 역할을 수행하고 있고, 역할을 구현하기 위해 추상 클래스나 인터페이스를 사용할 수 있다.

객체의 암시적인 타입에 따라 행동을 분기해야 한다면 암시적인 타입을 명시적인 클래스로 정의하고 행동을 나눔으로써 응집도 문제를 해결할 수 있다.

객체의 타입에 따라 변하는 행동이 있다면 타입을 분리하고 변화하는 행동을 각 타입의 책임으로 할당하라는 것이다. GRASP에서는 이를 POLYMORPHISM(다형성) 패턴이라고 부른다.

### 변경으로부터 보호하기

새로운 할인 조건이 추가돼도 Movie는 영향받지 않는다.

변경을 캡슐화하도록 책임을 할당하는 것을 GRASP에서는 PROTECTED VARIATIONS(변경 보호) 패턴이라고 부른다.

### Movie 클래스 개선하기

Moview 역시 금액 할인 정책 영화와 비율 할인 정책 영화라는 두 가지 타입을 하나의 클래스 안에 구현하고 있기 때문에 하나 이상의 이유로 변경될 수 있다.

AmountDiscountMovie, PercentDiscountMovie로 개선하자.

Movie의 경우 구현을 공유할 필요가 있으므로, 추상 클래스를 이용해 역할을 구현하자.

이렇게 되면 모든 클래스의 내부 구현은 캡슐화돼 있고 모든 클래스는 변경의 이유를 오직 하나씩만 가지게 된다. 각 클래스는 응집도가 높고 결합도가 낮다. 클래스는 작고 오직 한 가지 일만 수행한다. 책임은 적절하게 분배돼 있다.

### 변경과 유연성

개발자로서 변경에 대비할 수 있는 두 가지 방법

1. 코드를 이해하고 수정하기 쉽도록 최대한 단순하게 설계하는 것
2. 코드를 수정하지 않고도 변경에 수용할 수 있도록 코드를 더 유연하게 만드는 것

대부분 전자가 더 좋은 방법이지만 유사한 변경이 반복적으로 발생하고 있다면 복잡성이 상승하더라도 유연성을 추가하는 두 번째 방법이 더 좋다.

Movie에서 할인 정책을 상속이 아닌 합성으로 구현하면 유연한 설계가 될 수 있다.

## 책임 주도 설계의 대안

이해하기 쉽고 수정하기 쉬운 소프트웨어로 개선하기 위해 겉으로 보이는 동작은 바꾸지 않은 채 내부 구조를 변경하는 것을 리팩터링(Refactoring)이라고 부른다.

### 메서드 응집도

응집도 높은 메서드는 변경되는 이유가 단 하나여야 한다.

객체로 책임을 분배할 때 가장 먼저 할 일은 메서드를 응집도 있는 수준으로 분해하는 것이다.

## 객체를 자율적으로 만들자

객체는 자율적인 존재여야 하므로 자신이 소유하고 있는 데이터를 자기 스스로 처리하도록 만드는 것이 자율적인 객체를 만드는 지름길이다.

메서드를 다른 클래스로 이동시킬 때는 인자에 정의된 클래스 중 하나로 이동하는 경우가 일반적이다.

책임 주도 설계 방법에 익숙하지 않다면 일단 데이터 중심으로 구현한 후 이를 리팩토링하더라도 유사한 결과를 얻을 수 있다.
SaaS란 클라우드 서비스 제공업체가 소프트웨어와 인프라를 관리하면서 플랫폼을 제공하는 것을 뜻한다.
사용자는 웹 대시보드나 CLI를 통해 플랫폼의 세부 설정을 간편하게 할 수 있으며 네트워크, 스토리지, 가상화 등 다양한 종류의 운영상 이슈는 업체에서 관리하기 때문에 매우 편리하게 사용할 수 있다.

**인프라 관리의 이점**  
카프카 클러스터는 상용환경에서 최소 3대 이상의 서버로 운영한다.
SaaS를 사용한 경우 인프라 운영 관련 역할에서 자유로울 수 있다.
카프카 SaaS 서비스를 사용하게 되면 브로커가 올라가는 서버는 자동으로 관리되기 때문이다.

만약 브로커들 중 일부에 이슈가 발생하여 서버를 재시작하는 상황이 일어나더라도 카프카 운영자는 크게 신경 쓸 일이 없다.
왜냐하면 SaaS 서비스가 이슈를 감지하여 이슈가 생긴 서버를 제외하고 신규 장비에 브로커를 실행하여 클러스터를 복구하기 때문이다.

**모니터링 대시보드 제공**  
SaaS형 카프카에서는 자동화되어 만들어진 클러스터로부터 운영에 필요한 지표들을 수집하고 그래프로 보여주는 옵션이 제공된다.

**보안 설정**  

**서비스 사용 비용** 
조금 더 비싼긴 함

**커스터마이징의 제한**  
SaaS 서비스들은 인프라부터 애플리케이션 설치까지 모든 부분이 자동화되어 있고 업체에서 설정한 아키텍처를 따라가기 때문에 상세한 설정을 적용하거나 클러스터 아키텍처의 변화가 필요할 경우 적용하기 매우 어렵다.

**클라우드 종속성**  

## 컨플루언트 클라우드
컨플루언트(Confluent)는 카프카에 대한 개념을 최초로 생각하고 아키텍처를 제안, 개발한 인물인 제이 크랩스가 설립한 회사이다.

컨플루언트에서 오픈소스로 공개하고 관리하고 있는 스키마 레지스트리, ksqlDB, kafka-connect-hdfs 등과 같은 소스 코드들은 카프카를 활용하는 생태계의 범위를 점차 늘려나가고 있다.

### 컨플루언트 클라우드 활용
직접 클러스터를 관리하지 않고 컨플루언트에 위임함으로써 카프카 클러스터를 안전하고 빠르게 구축, 운영할 수 있다.

컨플루언트 클라우드를 통해 생성한 카프카 클러스터는 SASL_SSL 보안 설정이 기본으로 설정된다.
SASL_SSL 보안은 아이디와 패스워드를 통한 인증 방식으로서 SASL_SSL과 SASL_PLAIN 2가지 방식이 있는데
그 중 SASL_SSL 보안 인증 방식은 SSL 통신을 위한 인증으로 탈취 위협으로부터 가장 안전한 방식이다.

CCLOUD CLI는 컨플루언트에서 자체적으로 커스터마이징한 카프카 CLI 툴이다.
이 툴을 통해 이전에 기존 카프카에 포함되어 있던 CLI 중 하나인 kafka-console-consumer를 사용할 수 있다.

**커넥터 S3 적재 파이프라인**  
토픽에 적재된 데이터를 다른 타깃 애플리케이션에 적재하기 위해서 카프카 커넥터를 사용할 수 있다.
직접 카프카 커넥터를 운영하지 않더라도 컨플루언트 클라우드에서는 대시보드를 통해 설정하여 커넥터를 SaaS 형태로 사용할 수 있다.

### 컨플루언트 카프카 정리  
컨플루언트 클라우드는 카프카 클러스터의 기본 기능 + 부가기능을 웹 대시보드를 통해 운영할 수 있도록 도와준다.

## AWS MSK
MSK(Managed Streaming for Apache Kafka)는 AWS에서 제공하는 SaaS형 아파치 카프카 서비스이다.
AWS MSK는 AWS 인프라에서 카프카 클러스터를 생성, 업데이트, 삭제 등과 같은 운영 요소를 대시보드를 통해 제공한다.

안전하게 접속할 수 있도록 클러스터와 연결 동시 TLS 인증 보안을 설정할 수 있다.

MSK의 큰 이점: AWS 서비스와의 연동: 카프카 브로커 로그를 AWS S3에 적재, AWS 클라우드 와치에서 기본 모니터링 가능

### MSK 활용
**VPC**  
Virtual Private Cloud의 약자로 사용자가 정의한 가상의 네트워크이다.

**AZ**  
AZ(available zone)는 AWS 리전에 존재하는 개별 데이터 센터를 뜻한다.

**서브넷**  
서브넷은 VPC 내부에서 생성할 수 있는 데트워크 대역이다.

**인터넷 게이트웨이**  
인터넷 게이트웨이가 설정되지 않은 서브넷은 구글, 네이버와 같은 퍼블릿 네트워크와 통신할 수 없다.

**라우팅 테이블**  
VPC, 인터넷 게이트웨이, VPN 연결 시 서브넷 간 패킷 전달 규칙을 지정한다.

**EBS**  
Elastic Block Store라고 불리는 EBS는 EC2 인스턴스에 사용할 수 있도록 설계된 볼륨 스토리지 서비스이다.

EBS 스토리지 용량을 정할때는 파티션의 복제 개수, 토픽의 데이터 삭제 정책, 토픽 데이터 압축 정책 등을 다각적으로 고려하여 EBS 용량을 계산해야 한다.

**보안**  
MSK 클러스터 보안
- 클러스터에서 브로커 간 통신 암호화
  - TLS 암호화
- 클라이언트와 브로커 간 통신 암호화
  - TLS 암호화 데이터만 허용
  - TLS와 평문 둘 다 허용
  - 평문만 허용
- 스토리지 데이터 암호화
  - MSK 클러스터 생성 시 고객 마스터 키(CMK)를 자동 생성하여 암호화하는 방식
  - 이미 존재하는 고객 마스터 키를 사용

**모니터링**  
- 클라우드와치를 사용한 클러스터 모니터링
  - 기본 수준: 클러스터 CVPU 유휴시간, 브로커 총 파티션 개수, 브로커 총 토픽 개수
  - 브로커 수준: 네트워크 초당 바이트 수, 리더 복제 파티션 개수, 브로커당 파티션 개수
  - 토픽 수준: 토픽당 수신된 바이트 수, 보낸 바이트 수
- 프로메테우스 모니터링
- 브로커 로그 적재를 통한 로그 모니터링

**MSK 클러스터 연동 인스턴스 생성**
MSK 클러스터로 구축된 카프카 클러스터는 EC2 인스턴스에 직접 클러스터를 생성했을 때와 다르게 클러스터 접속을 위한 엔드포인트를 지원하지 않는다.
-> AWS 내부에 있는 EC2 인스턴스에서 접근해야만 한다.

클러스터로 접근하는 가장 쉬운 방법은 VPC 내부에 MSK 클러스터 연동을 위한 인스턴스를 생성하는 것이다.

### MSK 정리
여러가지 편의 기능으로 클러스터 운영자가 카프카 모니터링을 위한 아키텍처에 들이는 수고와 시간을 줄일 수 있다.

카프카 클러스터의 인프라 운영은 AWS에 위임하고 카프카를 활용하여 실질적인 가치를 창출하는 데에 집중한다면 더욱 나은 서비스 발전을 이룩할 수 있을 것이라 생각한다.

## 정리
클러스터 운영상 허들을 낮춰주는 것이 MSK와 컨플루언트 클라우드.

비용과 운영상 편리함의 Trade-off
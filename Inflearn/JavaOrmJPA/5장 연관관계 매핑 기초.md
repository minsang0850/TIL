## 단방향 연관관계
**객체를 테이블에 맞추어 모델링**
- 테이블은 외래 키로 조인을 사용해서 연관된 테이블을 찾는다.
- 객체는 참조를 사용해서 연관된 객체를 찾는다.
- 큰 간극

**객체 지향 모델링**
```java
@Entity
public class Member {
    //...
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;
    //...
}
```
```java
member.setTeam(team); //단방향 연관관계 설정, 참조 저장
```

## 양방향 연관관계와 연관관계의 주인 1 - 기본
양방향 연관관계를 사용해도 DB 테이블에는 변화 X
-> 연관 데이터를 알고 싶으면 join하면 되기 때문

### 연관관계의 주인과 mappedBy
- 객체 연관관계 = 2개
  - 회원 -> 팀 (단방향)
  - 팀 -> 회원 (단방향)
- 테이블 연관관계 = 1개
  - 회원 <-> 팀의 연관관계 = 1개

### 객체의 양방향 연관관계
사실 양방향 관계가 아니라 서로 다른 단방향 관계 2개다.

### 테이블의 양방향 연관관계
테이블은 외래 키 하나로 두 테이블의 연관관계를 관리


그러면 Member의 Team을 바꾸려면 어떻게 해야 할까?
-> 둘 중 하나로 외래 키를 관리해야 한다.

### 연관관계의 주인(Owner)
**양방향 매핑 규칙**
- 객체의 두 관계중 하나를 연관관계를 주인으로 지정
- 주인만이 외래 키를 관리(등록, 수정)
- 주인이 아닌쪽은 읽기만 가능
- 주인은 mappedBy 속성 X
- 주인이 아니면 mappedBy 속성으로 주인을 지정

**누구를 주인으로?**
- 외래 키가 있는 곳을 주인으로 정해라
- 여기서는 Member.team이 연관관계의 주인
- 비즈니스 로직을 기준으로 연관관계의 주인을 선택하면 안됨

이렇게 해야 헷갈리지 않음.
- 반대로 하면 team의 members를 가져왔을때 다른 테이블(member)에 업데이트가 나갈 수 있음
- 성능 이슈도 조금 있음

DB 입장에선 외래키가 있는곳이 N, 없는 쪽이 1.

자동차와 바퀴가 있으면, 연관관계 주인은 바퀴!

## 양방향 연관관계와 연관관계의 주인 2 - 주의점, 정리
연관관계의 주인에 값을 세팅해야 함.

양방향 연관관계일때는 양쪽에 값을 넣어주는게 맞음.

양쪽에 값을 넣지 않으면  1차 캐시에서 값을 가져올 때 이슈가 발생할 수 있음

**주의**
- 순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자
- 연관관계 편의 메서드를 생성하자
- 양방향 매핑시에 무한 루프를 조심하자.
  - toString(), lombok, JSON 생성 라이브러리
- 연관관계의 주인은 정해져있지만 편의 메서드는 어느 쪽에 써도 상관 없다.
  - 하지만 양쪽에 생성하면 실수 발생할 여지가 있음

### 정리
- 단방향 매핑만으로도 이미 연관관계 매핑은 완료
- 양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가된 것 뿐
- JPQL에서 역방향으로 탐색할 일이 많음
- 단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨 (테이블에 영향을 주지 않음)




